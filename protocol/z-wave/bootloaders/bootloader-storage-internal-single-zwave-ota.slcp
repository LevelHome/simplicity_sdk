project_name: bootloader-storage-internal-single-zwave-ota
package: bootloader # Do not change, this is part of the bootloader package
quality: production
label: Bootloader - SoC Internal Storage (OTA for Z-Wave Applications)
description: >
  This sample configuration of the Gecko bootloader configures the bootloader 
  to use the internal main flash to store firmware update images. The storage 
  configuration is set up to store a single firmware update image at a time, 
  in a single storage slot.
category: Z-Wave|Bootloaders

filter:
  - name: "Device Type"
    value: ["SoC"]
  - name: "Project Difficulty"
    value: ["Advanced"]
  - name: "Wireless Technology"
    value: ["Z-Wave"]
  - name: "MCU"
    value: ["Bootloader"]
    
component:
  - id: bootloader_core
  - id: bootloader_crc
  - id: bootloader_aes_sha_ecdsa
  - id: bootloader_internal_storage
  - id: bootloader_storage_slots
  - id: bootloader_image_parser
  - id: bootloader_common_storage
  - id: bootloader_token_management
  - id: bootloader_app_upgrade_version
  - id: bootloader_compression_lzma

requires:  
  - name: bootloader_compression_lzma

# Info:
# device_sdid_210: ZG23
# device_sdid_235: ZG28
configuration:
  - name: BOOTLOADER_ENFORCE_SIGNED_UPGRADE
    value: 1
  - name: BOOTLOADER_WRITE_DISABLE
    value: 1
  - name: APPLICATION_VERIFICATION_SKIP_EM4_RST
    value: 1
  - name: SLOT0_ENABLE
    value: 1
  - name: BOOTLOADER_VERSION_MAIN_CUSTOMER
    value: 3
    condition: [device_sdid_210]
  - name: BOOTLOADER_VERSION_MAIN_CUSTOMER
    value: 2
    condition: [device_sdid_235]
  - name: BOOTLOADER_FALLBACK_LEGACY_KEY
    value: 1
  - name: BOOTLOADER_SE_UPGRADE_NO_STAGING
    value: 1
  - name: BTL_STORAGE_BASE_ADDRESS
    value: 0x8044000
  - name: SLOT_OVERLAP_ENABLE
    value: 1
    condition: [device_sdid_210]
  # SLOT1
  # Only enabled for ZG23 devices
  - name: SLOT1_ENABLE
    value: 1
    condition: [device_sdid_210]
  - name: SLOT1_START
    value: 0x8044000
    condition: [device_sdid_210]
  - name: SLOT1_SIZE
    value: 0x2C000
    condition: [device_sdid_210]
  # SLOT0
  - name: SLOT0_START
    value: 0x8046000
    condition: [device_sdid_210]
  - name: SLOT0_START
    value: 0x80C6000
    condition: [device_sdid_235]
  - name: SLOT0_SIZE
    value: 0x30000

config_file:
  - path: ../platform/SiliconLabs/PAL/BootLoader/sample-keys/sample_encrypt.key
    directory: sample_keys
  - path: ../platform/SiliconLabs/PAL/BootLoader/sample-keys/sample_sign.key
    directory: sample_keys

post_build:
  profile: zwave_bootloader

tag:
  - prebuilt_demo